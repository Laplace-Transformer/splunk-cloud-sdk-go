// Package provisioner -- generated by scloudgen
// !! DO NOT EDIT !!
//
package provisioner

import (
	"fmt"

	"github.com/spf13/cobra"
	"github.com/splunk/splunk-cloud-sdk-go/scloud_generated/auth"
	"github.com/splunk/splunk-cloud-sdk-go/scloud_generated/flags"
	"github.com/splunk/splunk-cloud-sdk-go/scloud_generated/jsonx"
	model "github.com/splunk/splunk-cloud-sdk-go/services/provisioner"
)

// CreateInvite Creates an invitation for a person to join the tenant using their email address.
func CreateInvite(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClient()
	if err != nil {
		return err
	}

	// Parse all flags
	var comment *string
	err = flags.ParseFlag(cmd.Flags(), "comment", comment)
	if err != nil {
		return fmt.Errorf(`error parsing "comment": ` + err.Error())
	}
	var email string
	err = flags.ParseFlag(cmd.Flags(), "email", &email)
	if err != nil {
		return fmt.Errorf(`error parsing "email": ` + err.Error())
	}
	var groups []string
	err = flags.ParseFlag(cmd.Flags(), "groups", &groups)
	if err != nil {
		return fmt.Errorf(`error parsing "groups": ` + err.Error())
	}

	// Form the request body
	body := model.InviteBody{
		Comment: comment,
		Email:   email,
		Groups:  groups,
	}

	resp, err := client.ProvisionerService.CreateInvite(body)
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// CreateProvisionJob Creates a new job that provisions a new tenant and subscribes apps to the tenant.
func CreateProvisionJob(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClientSystemTenant()

	if err != nil {
		return err
	}

	// Parse all flags
	var apps []string
	err = flags.ParseFlag(cmd.Flags(), "apps", &apps)
	if err != nil {
		return fmt.Errorf(`error parsing "apps": ` + err.Error())
	}
	var tenant *string
	err = flags.ParseFlag(cmd.Flags(), "tenant", tenant)
	if err != nil {
		return fmt.Errorf(`error parsing "tenant": ` + err.Error())
	}

	// Form the request body
	body := model.CreateProvisionJobBody{
		Apps:   apps,
		Tenant: tenant,
	}

	resp, err := client.ProvisionerService.CreateProvisionJob(body)
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// DeleteInvite Removes an invitation in the given tenant.
func DeleteInvite(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClient()
	if err != nil {
		return err
	}

	// Parse all flags
	var inviteId string
	err = flags.ParseFlag(cmd.Flags(), "invite-id", &inviteId)
	if err != nil {
		return fmt.Errorf(`error parsing "invite-id": ` + err.Error())
	}

	err = client.ProvisionerService.DeleteInvite(inviteId)
	if err != nil {
		return err
	}

	return nil
}

// GetInvite Returns an invitation in the given tenant.
func GetInvite(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClient()
	if err != nil {
		return err
	}

	// Parse all flags
	var inviteId string
	err = flags.ParseFlag(cmd.Flags(), "invite-id", &inviteId)
	if err != nil {
		return fmt.Errorf(`error parsing "invite-id": ` + err.Error())
	}

	resp, err := client.ProvisionerService.GetInvite(inviteId)
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// GetProvisionJob Returns details of a specific provision job.
func GetProvisionJob(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClientSystemTenant()

	if err != nil {
		return err
	}

	// Parse all flags
	var jobId string
	err = flags.ParseFlag(cmd.Flags(), "job-id", &jobId)
	if err != nil {
		return fmt.Errorf(`error parsing "job-id": ` + err.Error())
	}

	resp, err := client.ProvisionerService.GetProvisionJob(jobId)
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// GetTenant Returns a specific tenant.
func GetTenant(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClientSystemTenant()

	if err != nil {
		return err
	}

	// Parse all flags
	var tenantName string
	err = flags.ParseFlag(cmd.Flags(), "tenant-name", &tenantName)
	if err != nil {
		return fmt.Errorf(`error parsing "tenant-name": ` + err.Error())
	}

	resp, err := client.ProvisionerService.GetTenant(tenantName)
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// ListInvites Returns a list of invitations in a given tenant.
func ListInvites(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClient()
	if err != nil {
		return err
	}

	resp, err := client.ProvisionerService.ListInvites()
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// ListProvisionJobs Returns a list of all provision jobs created by the user.
func ListProvisionJobs(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClientSystemTenant()

	if err != nil {
		return err
	}

	resp, err := client.ProvisionerService.ListProvisionJobs()
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// ListTenants Returns all tenants that the user can read.
func ListTenants(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClientSystemTenant()

	if err != nil {
		return err
	}

	resp, err := client.ProvisionerService.ListTenants()
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}

// UpdateInvite Modifies an invitation in the given tenant.
func UpdateInvite(cmd *cobra.Command, args []string) error {

	client, err := auth.GetClient()
	if err != nil {
		return err
	}

	// Parse all flags
	var action string
	err = flags.ParseFlag(cmd.Flags(), "action", &action)
	if err != nil {
		return fmt.Errorf(`error parsing "action": ` + err.Error())
	}
	var inviteId string
	err = flags.ParseFlag(cmd.Flags(), "invite-id", &inviteId)
	if err != nil {
		return fmt.Errorf(`error parsing "invite-id": ` + err.Error())
	}

	// Form the request body
	body := model.UpdateInviteBody{
		//Action: action,
	}

	resp, err := client.ProvisionerService.UpdateInvite(inviteId, body)
	if err != nil {
		return err
	}
	jsonx.Pprint(cmd, resp)
	return nil
}
